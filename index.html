<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Mobile 3D Experience</title>
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      touch-action: none;
    }
    #joystick {
      position: fixed;
      bottom: 30px;
      left: 30px;
      width: 100px;
      height: 100px;
      background: rgba(0,0,0,0.3);
      border-radius: 50%;
      z-index: 1000;
    }
    #joystick-knob {
      position: absolute;
      width: 40px;
      height: 40px;
      background: rgba(255,255,255,0.7);
      border-radius: 50%;
      top: 30px;
      left: 30px;
    }
    #interact-btn {
      position: fixed;
      bottom: 40px;
      right: 40px;
      width: 80px;
      height: 80px;
      background: rgba(0,200,255,0.5);
      border-radius: 50%;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-family: Arial;
      font-weight: bold;
    }
    .interactive-item {
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
  </style>
</head>
<body>
  <a-scene
    loading-screen="dotsColor: #00ffff; backgroundColor: #111"
    cursor="rayOrigin: mouse"
    raycaster="objects: .interactive-item"
    renderer="antialias: true">

    <!-- Camera -->
    <a-entity camera look-controls="touchEnabled: true; mouseEnabled: false">
      <a-cursor></a-cursor>
    </a-entity>

    <!-- Environment -->
    <a-box static-body width="20" height="10" depth="0.5" position="0 0 -10" color="#333"></a-box>
    <a-box static-body width="0.5" height="10" depth="20" position="-10 0 0" color="#333"></a-box>
    <a-box static-body width="0.5" height="10" depth="20" position="10 0 0" color="#333"></a-box>
    <a-plane static-body width="50" height="50" rotation="-90 0 0" color="#222233"></a-plane>

    <!-- Interactive Objects -->
    <a-sphere class="interactive-item" position="0 1 -5" radius="1" color="#FF0000" 
              data-action="alert" data-message="You touched the red sphere!"></a-sphere>
    <a-box class="interactive-item" position="3 0.5 -3" width="1.5" height="1.5" depth="1.5" color="#00FF00"
          data-action="color" data-color="#FF00FF"></a-box>
    <a-cylinder class="interactive-item" position="-3 1 -4" radius="0.8" height="1.6" color="#0000FF"
                data-action="rotate"></a-cylinder>

  </a-scene>

  <!-- Mobile Controls -->
  <div id="joystick">
    <div id="joystick-knob"></div>
  </div>
  <div id="interact-btn">TAP</div>

  <script>
    // Mobile Movement Controls
    const joystick = document.getElementById('joystick');
    const knob = document.getElementById('joystick-knob');
    const interactBtn = document.getElementById('interact-btn');
    const camera = document.querySelector('[camera]');
    
    let touchId = null;
    let maxJoystickDistance = 40;
    let moveX = 0;
    let moveZ = 0;
    
    // Joystick Touch Events
    joystick.addEventListener('touchstart', (e) => {
      e.preventDefault();
      touchId = e.touches[0].identifier;
      updateJoystick(e.touches[0]);
    });
    
    document.addEventListener('touchmove', (e) => {
      if (!touchId) return;
      const touch = Array.from(e.touches).find(t => t.identifier === touchId);
      if (touch) updateJoystick(touch);
    });
    
    document.addEventListener('touchend', () => {
      touchId = null;
      knob.style.transform = 'translate(30px, 30px)';
      moveX = 0;
      moveZ = 0;
    });
    
    function updateJoystick(touch) {
      const rect = joystick.getBoundingClientRect();
      const centerX = rect.left + rect.width/2;
      const centerY = rect.top + rect.height/2;
      const deltaX = touch.clientX - centerX;
      const deltaY = touch.clientY - centerY;
      const distance = Math.sqrt(deltaX*deltaX + deltaY*deltaY);
      const angle = Math.atan2(deltaY, deltaX);
      
      const limitedDistance = Math.min(distance, maxJoystickDistance);
      const limitedX = Math.cos(angle) * limitedDistance;
      const limitedY = Math.sin(angle) * limitedDistance;
      
      knob.style.transform = `translate(${limitedX + 30}px, ${limitedY + 30}px)`;
      
      // Movement direction (relative to camera)
      moveX = limitedX / maxJoystickDistance * 0.1;
      moveZ = limitedY / maxJoystickDistance * 0.1;
    }
    
    // Interaction System
    interactBtn.addEventListener('touchstart', (e) => {
      e.preventDefault();
      const cursor = document.querySelector('a-cursor');
      if (cursor.components.raycaster.intersectedEl) {
        const el = cursor.components.raycaster.intersectedEl;
        if (el.classList.contains('interactive-item')) {
          handleInteraction(el);
        }
      }
    });
    
    function handleInteraction(el) {
      const action = el.getAttribute('data-action');
      
      switch(action) {
        case 'alert':
          alert(el.getAttribute('data-message'));
          break;
          
        case 'color':
          const newColor = el.getAttribute('data-color');
          el.setAttribute('color', newColor);
          break;
          
        case 'rotate':
          el.object3D.rotation.y += Math.PI/4;
          break;
      }
      
      // Visual feedback
      el.setAttribute('scale', '1.2 1.2 1.2');
      setTimeout(() => {
        el.setAttribute('scale', '1 1 1');
      }, 200);
    }
    
    // Movement Update Loop
    function updateCameraPosition() {
      if (moveX !== 0 || moveZ !== 0) {
        const direction = new THREE.Vector3(moveX, 0, moveZ);
        direction.applyQuaternion(camera.object3D.quaternion);
        const position = camera.getAttribute('position');
        position.x += direction.x;
        position.z += direction.z;
        camera.setAttribute('position', position);
      }
      requestAnimationFrame(updateCameraPosition);
    }
    updateCameraPosition();
  </script>
</body>
</html>
